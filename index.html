<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é®®å¥¶é…ª - ç·šä¸Šé è¨‚</title>

    <script async src="https://www.googletagmanager.com/gtag/js?id=AW-17855729381"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'AW-17855729381');
    </script>
    
    <style>
        /* --- åŸºç¤æ¨£å¼ (ç¶“å…¸ç¶ è‰²é¢¨æ ¼) --- */
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, "Microsoft JhengHei", "Segoe UI", Roboto, sans-serif; }
        body { background-color: #f5f5f5; color: #333; padding-bottom: 140px; }
        
        /* Header */
        header { 
            background-color: #fff; padding: 15px; 
            text-align: center; font-weight: bold; font-size: 1.3rem; 
            position: sticky; top: 0; box-shadow: 0 1px 3px rgba(0,0,0,0.1); 
            z-index: 100; 
            display: flex; align-items: center; justify-content: center; gap: 15px; 
        }
        .header-logo { height: 80px; width: auto; border-radius: 8px; }

        .container { padding: 15px; max-width: 600px; margin: 0 auto; }
        .section-header { font-size: 1.1rem; font-weight: bold; margin: 25px 0 10px 0; display: flex; align-items: center; color: #444; }
        .section-header::before { content: ''; display: inline-block; width: 5px; height: 18px; background: #00c300; margin-right: 8px; border-radius: 2px; }
        
        /* å–®ä¸€å±•ç¤ºå€å¡Š (å¤§æ ¼åœ–ç‰‡æˆ–å½±ç‰‡) */
        .package-box {
            background: #fff;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.03);
            border: 1px solid #eee;
            margin-bottom: 20px;
        }
        .package-img {
            width: 100%;
            border-radius: 8px;
            margin-bottom: 10px;
            display: block;
        }
        .package-text {
            color: #666;
            font-size: 0.9rem;
            line-height: 1.5;
            font-weight: bold;
        }

        /* é›™æ¬„å½±ç‰‡æ’ç‰ˆ (ä¸¦æ’) */
        .video-row {
            display: grid;
            grid-template-columns: 1fr 1fr; /* å·¦å³å„ä¸€åŠ */
            gap: 10px; /* é–“è· */
            margin-bottom: 20px;
        }
        .video-box {
            background: #fff;
            border-radius: 10px;
            padding: 5px; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.03);
            border: 1px solid #eee;
        }
        .video-box video {
            width: 100%;
            border-radius: 6px;
            display: block;
        }

        /* å“ç‰Œæ•…äº‹å€å¡Š */
        .brand-story {
            background: #fff;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid #eee;
            line-height: 1.8;
            color: #555;
            text-align: justify;
        }
        .brand-story h3 {
            text-align: center;
            color: #2e7d32;
            margin: 0 0 15px 0;
            font-size: 1.1rem;
            font-weight: bold;
        }
        .brand-story p {
            margin-bottom: 12px;
            font-size: 0.95rem;
        }
        .brand-story p:last-child {
            margin-bottom: 0;
        }

        /* èœå–® */
        .menu-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
        .menu-item { background: #fff; border-radius: 10px; padding: 10px; display: flex; flex-direction: column; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.03); border: 1px solid #eee; text-align: center; }
        
        .menu-img { 
            width: 100%; 
            aspect-ratio: 1 / 1; 
            object-fit: cover;    
            border-radius: 8px; 
            margin-bottom: 8px; 
            background-color: #eee; 
        }
        .menu-name { font-size: 1rem; font-weight: 600; margin-bottom: 3px; line-height: 1.2; }
        .menu-desc { font-size: 0.8rem; color: #666; margin-bottom: 8px; line-height: 1.4; min-height: 3.5em; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }
        .menu-price { color: #d63031; font-weight: bold; font-size: 1rem; margin-bottom: 8px; }
        .add-btn { background: #fff; border: 1px solid #00c300; color: #00c300; padding: 5px 20px; border-radius: 20px; font-size: 0.9rem; cursor: pointer; transition: 0.2s; font-weight: bold; }
        .add-btn:active { background: #00c300; color: #fff; }

        /* è³¼ç‰©è»Š */
        .cart-item { background: #fff; border-radius: 10px; padding: 12px; margin-bottom: 10px; display: flex; align-items: center; border-left: 5px solid #ddd; }
        .cart-info { flex: 1; margin-left: 10px; }
        .cart-title { font-weight: bold; font-size: 1rem; }
        .cart-subtotal { color: #888; font-size: 0.85rem; margin-top: 3px; }
        
        .cart-right-col { display: flex; flex-direction: column; align-items: flex-end; gap: 5px; }
        .qty-control { display: flex; align-items: center; gap: 8px; }
        .qty-btn { width: 28px; height: 28px; border-radius: 50%; border: 1px solid #ddd; background: #fff; font-size: 1.1rem; display: flex; align-items: center; justify-content: center; }
        .adult-warn { font-size: 0.7rem; color: #e63946; font-weight: bold; letter-spacing: 0.5px; }

        /* è¡¨å–® */
        .options-section { background: #fff; border-radius: 10px; padding: 20px; margin-top: 20px; }
        .form-group { margin-bottom: 15px; }
        .form-label { display: block; font-size: 0.9rem; margin-bottom: 5px; color: #666; }
        .form-input { width: 100%; padding: 12px; font-size: 1rem; border: 1px solid #ddd; border-radius: 8px; background: #fdfdfd; outline: none; }
        textarea.form-input { resize: vertical; min-height: 80px; font-family: inherit; }
        .form-input:focus { border-color: #00c300; }
        .form-input:disabled { background-color: #e9ecef; cursor: not-allowed; color: #6c757d; }
        
        .radio-group { display: flex; gap: 15px; margin-bottom: 15px; }
        .radio-label { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 8px; display: flex; align-items: center; justify-content: center; gap: 5px; cursor: pointer; }
        .radio-input:checked + span { color: #00c300; font-weight: bold; }
        #address-row { display: none; }

        /* å„ªæƒ åˆ¸å€å¡Š */
        .coupon-section {
            background-color: #f1f8e9;
            border: 2px dashed #81c784;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .coupon-banner {
            display: block;
            width: 100%;
            margin-bottom: 15px;
            border-radius: 6px;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .coupon-input-group {
            display: flex;
            gap: 10px;
        }
        .coupon-btn {
            background-color: #2e7d32;
            color: white;
            border: none;
            padding: 0 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            white-space: nowrap;
        }
        #coupon-msg {
            font-size: 0.85rem;
            margin-top: 8px;
            font-weight: bold;
        }

        /* è³‡è¨Šå€å¡Š (è‡ªå–/å®…é…) */
        .info-box {
            padding: 15px;
            border-radius: 8px;
            font-size: 0.95rem;
            margin-bottom: 15px;
            line-height: 1.6;
            text-align: center;
        }

        /* è‡ªå–ï¼šè—è‰² */
        #pickup-info-box {
            background-color: #e3f2fd;
            color: #0d47a1;
            border: 1px solid #bbdefb;
        }

        /* å®…é…ï¼šæ©˜è‰² */
        #delivery-info-box {
            background-color: #fff3e0;
            color: #e65100;
            border: 1px solid #ffe0b2;
            display: none;
            text-align: left;
        }
        .delivery-title { font-weight: bold; margin-bottom: 5px; font-size: 1rem; }

        /* åº•éƒ¨ */
        .bottom-bar { position: fixed; bottom: 0; left: 0; width: 100%; background: #fff; padding: 12px 20px; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; z-index: 999; }
        .price-area { display: flex; flex-direction: column; }
        .total-price { font-size: 1.3rem; font-weight: bold; color: #d63031; }
        .discount-tag { font-size: 0.75rem; background: #ff4757; color: white; padding: 2px 6px; border-radius: 4px; margin-left: 5px; display: none; }
        .promo-hint { font-size: 0.75rem; color: #e63946; margin-top: 4px; line-height: 1.4; font-weight: bold; }
        
        .checkout-btn { background-color: #00c300; color: #fff; border: none; padding: 12px 35px; border-radius: 25px; font-size: 1rem; font-weight: bold; cursor: pointer; }
        .checkout-btn:disabled { background-color: #ccc; cursor: not-allowed; }
        .empty-cart-msg { text-align: center; color: #aaa; padding: 20px; font-size: 0.9rem; }

        /* æ”¶æ“šé  */
        #receipt-view { display: none; background: #fff; min-height: 100vh; padding: 20px; text-align: center; }
        .receipt-logo { width: 80px; height: auto; margin-bottom: 15px; border-radius: 10px; }
        .receipt-icon { font-size: 3rem; color: #00c300; margin-bottom: 10px; }
        .receipt-title { font-size: 1.5rem; font-weight: bold; margin-bottom: 5px; }
        .receipt-time { color: #888; font-size: 0.9rem; margin-bottom: 20px; }
        .receipt-card { background: #f9f9f9; border-radius: 10px; padding: 15px; text-align: left; margin-bottom: 20px; border: 1px dashed #ddd; }
        .receipt-row { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 0.95rem; }
        .receipt-row.bold { font-weight: bold; border-top: 1px solid #ddd; padding-top: 10px; margin-top: 10px; font-size: 1.1rem; }
        .receipt-row.discount-row { color: #d63031; }
        
        .receipt-bank-box { background: #e8f5e9; padding: 15px; border-radius: 8px; margin-bottom: 20px; text-align: left; border: 1px solid #c8e6c9; }
        .bank-title { color: #2e7d32; font-weight: bold; margin-bottom: 5px; font-size: 0.9rem; }
        .bank-detail-row { display: flex; align-items: center; justify-content: space-between; gap: 10px; }
        .bank-detail { font-size: 1.2rem; font-weight: bold; color: #333; letter-spacing: 1px; }
        
        .copy-btn {
            background-color: #333;
            color: #fff;
            border: none;
            padding: 4px 10px;
            font-size: 0.8rem;
            border-radius: 5px;
            cursor: pointer;
            flex-shrink: 0;
        }
        .copy-btn:active { transform: scale(0.95); background-color: #555; }
        
        .screenshot-box { background: #fff8e1; border: 2px dashed #ffc107; padding: 15px; margin: 20px 0; border-radius: 10px; color: #ff6f00; display: flex; align-items: center; justify-content: center; gap: 10px; text-align: left; }
        .screenshot-icon { font-size: 1.8rem; }
        .screenshot-text { font-size: 1rem; font-weight: bold; line-height: 1.4; }

        .pay-btn { display: block; width: 100%; padding: 15px; background: #00c300; color: white; text-decoration: none; border-radius: 30px; font-weight: bold; margin-bottom: 15px; }
        .home-btn { background: #fff; color: #666; border: 1px solid #ddd; }
        
        /* LINE æŒ‰éˆ•æ¨£å¼ */
        .line-btn-style {
            display: inline-block;
            background-color: #06c755;
            color: white;
            padding: 10px 25px;
            border-radius: 25px;
            text-decoration: none;
            font-weight: bold;
            font-size: 0.95rem;
            box-shadow: 0 2px 5px rgba(6, 199, 85, 0.2);
            transition: 0.2s;
        }
        .line-btn-style:active { transform: scale(0.98); }

        #loading-overlay { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(255,255,255,0.8); z-index: 1000; justify-content: center; align-items: center; flex-direction: column; }
        .spinner { border: 4px solid #f3f3f3; border-top: 4px solid #00c300; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin-bottom: 10px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="loading-overlay">
        <div class="spinner"></div>
        <div>æ­£åœ¨å‚³é€è¨‚å–®...</div>
    </div>

    <div id="shop-view">
        <header>
            <img src="logo.jpg" alt="Logo" class="header-logo">
            <span>ç·šä¸Šé è¨‚</span>
        </header>

        <div class="container">
            
            <div class="section-header">ç¶¿å¯†å£æ„Ÿå¯¦æ‹</div>
            <div class="package-box">
                <video class="package-img" controls autoplay loop muted playsinline>
                    <source src="420037fb-8f72-4541-9442-65f63c08cf93.mp4" type="video/mp4">
                    æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´å½±ç‰‡æ’­æ”¾ã€‚
                </video>
                <div class="package-text">
                    ğŸ¥ é»æ“Šæ’­æ”¾<br>
                    æ„Ÿå—æ¯ä¸€å£çš„æ»‘é †èˆ‡ç¶¿å¯†ï¼ŒçœŸæå¯¦æ–™çœ‹å¾—è¦‹ï¼
                </div>
            </div>

            <div class="section-header">ğŸ”¥ å¸‚é›†æ’éšŠå¯¦æ³</div>
            <div class="video-row">
                <div class="video-box">
                    <video controls autoplay loop muted playsinline>
                        <source src="s1.mp4" type="video/mp4">
                    </video>
                </div>
                <div class="video-box">
                    <video controls autoplay loop muted playsinline>
                        <source src="s2.mp4" type="video/mp4">
                    </video>
                </div>
            </div>

            <div class="section-header">ç¦®ç›’åŒ…è£å±•ç¤º</div>
            <div class="package-box">
                <img src="117903.jpg" alt="ç¦®ç›’åŒ…è£" class="package-img">
                <div class="package-text">
                    âœ¨ è³ªæ„Ÿä¿å†·è¢‹ + ç²¾ç¾ç¦®ç›’ (6å…¥è£)<br>
                    é€ç¦®è‡ªç”¨å…©ç›¸å®œï¼Œå¤§å‰å¤§åˆ©å¥½é‹åˆ°ï¼
                </div>
            </div>

            <div class="section-header">ğŸ“… 2026 æ–°å¹´è¡Œäº‹æ›†</div>
            <div class="package-box">
                <img src="d1.png" alt="æ–°å¹´è¡Œäº‹æ›†" class="package-img">
                <div class="package-text">
                    æ˜¥ç¯€æœŸé–“ç‡Ÿæ¥­æ™‚é–“èˆ‡å‡ºè²¨å…¬å‘Š
                </div>
            </div>

            <div class="section-header">é—œæ–¼æˆ‘å€‘</div>
            <div class="brand-story">
                <h3>å¥½é…ª â€”â€” ä¸‰å¯¶åª½çš„æº«æŸ”å …æŒï¼Œå¾å»šæˆ¿åˆ°å¸‚é›†çš„ç¾å‘³æ—…ç¨‹ã€‚</h3>
                <p>ã€Œå¥½é…ªã€çš„æ•…äº‹ï¼Œå§‹æ–¼ä¸€å€‹æ¯è¦ªå°å­©å­çš„æ„›ï¼Œå»æˆå½¢æ–¼ä¸€æ¬¡æ¬¡å‹‡æ•¢çš„å˜—è©¦ã€‚</p>
                <p>ç‚ºäº†è®“ä¸‰å€‹å­©å­åƒåˆ°æœ€ç´”ç²¹ã€ç„¡æ·»åŠ çš„é»å¿ƒï¼Œæˆ‘é–‹å§‹é‘½ç ”å¥¶é…ªçš„è£½ä½œã€‚èµ·åˆåªæ˜¯å®¶è£¡çš„ç§æˆ¿ç”œé»ï¼Œä½†åœ¨å…ˆç”Ÿçš„é¼“å‹µä¸‹ï¼Œæˆ‘æ±ºå®šè·¨å‡ºèˆ’é©åœˆã€‚ä¸åƒ…æŠ•ä¿ç”¢å“è²¬ä»»éšªã€å®Œæˆåˆæ³•çš„é£Ÿå“æ¥­è€…ç™»éŒ„ï¼Œç‚ºäº†è­‰æ˜ã€Œåª½åª½æ‰‹ä½œã€ä¹Ÿèƒ½æœ‰è·äººæ°´æº–ï¼Œæˆ‘æ›´åŠªåŠ›è€ƒå–äº†åœ‹å®¶ç´šçƒ˜ç„™è­‰ç…§ï¼Œç”¨å°ˆæ¥­çŸ¥è­˜ç‚ºå®¶äººçš„å¥åº·æŠŠé—œã€‚</p>
                <p>é›–ç„¶æ²’æœ‰è¯éº—åº—é¢ï¼Œä½†æˆ‘å€‘å‹¤è·‘å¸‚é›†ï¼Œæ¨è‘—æ”¤ä½åœ¨é¢¨å¹æ—¥æ›¬ä¸­èˆ‡å¤§å®¶è¦‹é¢ã€‚æ¯ä¸€æ¬¡åœ¨å¸‚é›†çœ‹åˆ°å®¢äººè©¦åƒå¾Œé©šè‰·çš„è¡¨æƒ…ï¼Œæˆ–æ˜¯è½è¦‹è€å®¢äººç‰¹åœ°è·‘ä¾†å›è³¼çš„ä¸€è²æ‹›å‘¼ï¼Œéƒ½æ˜¯æˆ‘å€‘å …æŒä¸‹å»çš„å‹•åŠ›ã€‚</p>
                <p>å¾é†«é™¢ã€å…¬å¸çš„åœ˜è³¼å£ç¢‘ï¼Œåˆ°å¸‚é›†è£¡çš„çœŸå¯¦äº’å‹•ï¼Œã€Œå¥½é…ªã€ä¸€æ­¥ä¸€è…³å°ï¼Œç”¨æœ€åš´è¬¹çš„æ…‹åº¦èˆ‡æœ€çœŸå¯¦çš„åŸæ–™ï¼Œå‘ˆç¾é€™ä»½ç°¡å–®å»ä¸ç°¡å–®çš„ç¾å‘³ã€‚</p>
            </div>

            <div class="section-header">é¸æ“‡å£å‘³</div>
            <div class="menu-grid" id="menu-list"></div>

            <div class="section-header">æ‚¨çš„è³¼ç‰©è»Š</div>
            <div id="cart-list">
                <div class="empty-cart-msg">å°šæœªåŠ å…¥å•†å“</div>
            </div>

            <div class="section-header">è¨‚è³¼è³‡è¨Š</div>
            <div class="options-section">
                
                <div class="coupon-section">
                    <a href="https://lin.ee/UHEkfgW" target="_blank">
                        <img src="line_promo.jpg" alt="åŠ å…¥LINEå¥½å‹é ˜å–å„ªæƒ " class="coupon-banner">
                    </a>
                    
                    <label class="form-label" style="color:#2e7d32;">ğŸ‰ ä½¿ç”¨æŠ˜æ‰£ç¢¼ (å¾ LINE å–å¾—)</label>
                    <div class="coupon-input-group">
                        <input type="text" id="coupon-code" class="form-input" placeholder="è«‹è¼¸å…¥æŠ˜æ‰£ç¢¼">
                        <button type="button" class="coupon-btn" onclick="applyCoupon()">å…Œæ›</button>
                    </div>
                    <div id="coupon-msg"></div>
                </div>

                <div class="form-label" style="margin-bottom:8px;">å–è²¨æ–¹å¼</div>
                <div class="radio-group">
                    <label class="radio-label">
                        <input type="radio" name="deliveryMethod" value="è‡ªå–" class="radio-input" checked onchange="updateDateSettings('pickup')">
                        <span>è‡ªå–</span>
                    </label>
                    <label class="radio-label">
                        <input type="radio" name="deliveryMethod" value="å®…é…" class="radio-input" onchange="updateDateSettings('delivery')">
                        <span>å®…é… (å†·è—)</span>
                    </label>
                </div>

                <div id="pickup-info-box" class="info-box">
                    <div style="font-weight:bold; margin-bottom:5px;">ğŸ“ è‡ªå–åœ°é»</div>
                    <div>å½°åŒ–å¸‚ä¸‰æ°‘è·¯430è™Ÿ (å…¨è¯é–€å£)</div>
                    <div style="font-weight:bold; margin-top:10px; margin-bottom:5px;">â° è‡ªå–æ™‚æ®µ</div>
                    <div>é€±äºŒè‡³é€±äº”ï¼š12:00~13:00 / 17:00~18:00</div>
                    <div>é€±å…­ï¼š10:00~12:00</div>
                    <div style="margin-top: 10px; padding-top: 10px; border-top: 1px dashed #a6c8e6; color: #d32f2f; font-weight: bold;">
                        ğŸ›µ å½°åŒ–å¸‚è‡ªå– å–®æ¬¡è¨‚è³¼æ»¿å…©ç›’ å¯ç´„æ™‚é–“å¤–é€
                    </div>
                </div>

                <div id="delivery-info-box" class="info-box">
                    <div class="delivery-title">ğŸšš æ–°ç«¹ç‰©æµå†·è—å®…é…è²»ç”¨</div>
                    <div>â€¢ 1-2 ç›’ (6-12å…¥)ï¼š<b>$130</b></div>
                    <div>â€¢ 3-8 ç›’ (18-48å…¥)ï¼š<b>$170</b></div>
                    <div>â€¢ 9 ç›’ä»¥ä¸Š (54å…¥ä»¥ä¸Š)ï¼š<b>$210</b></div>
                    <div style="font-size:0.85rem; color:#d84315; margin-top:8px;">* ç‚ºç¢ºä¿é‹é€å®‰å…¨ï¼Œå®…é…è¨‚å–®è«‹ä»¥ 6 çš„å€æ•¸ä¸‹å–® (æ•´ç›’å‡ºè²¨)ã€‚</div>
                </div>

                <div class="form-group">
                    <label class="form-label" id="date-label">å–è²¨/åˆ°è²¨æ—¥æœŸ</label>
                    
                    <select id="pickup-slot-select" class="form-input" style="display:none;">
                        <option value="" disabled selected>è«‹é¸æ“‡è‡ªå–æ™‚æ®µ...</option>
                    </select>
                    
                    <input type="text" id="delivery-date-text" class="form-input" value="å®…é…ä¸æŒ‡å®šæ—¥æœŸ (éœ€æŒ‡å®šè«‹æ´½å®¢æœ)" disabled style="display:none;">
                    
                    <div style="font-size:0.85rem; color:#d63031; margin-top:5px; font-weight:bold;" id="date-hint"></div>
                </div>

                <div class="form-label" style="margin-bottom:8px;">ä»˜æ¬¾æ–¹å¼</div>
                <div class="radio-group">
                    <label class="radio-label">
                        <input type="radio" name="paymentMethod" value="linepay" class="radio-input" checked>
                        <span>LINE Pay</span>
                    </label>
                    <label class="radio-label">
                        <input type="radio" name="paymentMethod" value="bank" class="radio-input">
                        <span>éŠ€è¡ŒåŒ¯æ¬¾</span>
                    </label>
                </div>

                <div class="form-group">
                    <label class="form-label">å§“å</label>
                    <input type="text" id="cust-name" class="form-input" placeholder="æ‚¨çš„ç¨±å‘¼">
                </div>
                <div class="form-group">
                    <label class="form-label">æ‰‹æ©Ÿ</label>
                    <input type="tel" id="cust-phone" class="form-input" placeholder="09xx-xxx-xxx" maxlength="10">
                </div>
                
                <div class="form-group" id="address-row">
                    <label class="form-label">å®…é…åœ°å€</label>
                    <div style="display: flex; flex-direction: column; gap: 10px;">
                        <select id="cust-city" class="form-input">
                            <option value="" disabled selected>è«‹é¸æ“‡ç¸£å¸‚</option>
                            <option value="åŸºéš†å¸‚">åŸºéš†å¸‚</option>
                            <option value="å°åŒ—å¸‚">å°åŒ—å¸‚</option>
                            <option value="æ–°åŒ—å¸‚">æ–°åŒ—å¸‚</option>
                            <option value="æ¡ƒåœ’å¸‚">æ¡ƒåœ’å¸‚</option>
                            <option value="æ–°ç«¹å¸‚">æ–°ç«¹å¸‚</option>
                            <option value="æ–°ç«¹ç¸£">æ–°ç«¹ç¸£</option>
                            <option value="è‹—æ —ç¸£">è‹—æ —ç¸£</option>
                            <option value="å°ä¸­å¸‚">å°ä¸­å¸‚</option>
                            <option value="å½°åŒ–å¸‚">å½°åŒ–å¸‚</option>
                            <option value="å½°åŒ–ç¸£">å½°åŒ–ç¸£</option>
                            <option value="å—æŠ•ç¸£">å—æŠ•ç¸£</option>
                            <option value="é›²æ—ç¸£">é›²æ—ç¸£</option>
                            <option value="å˜‰ç¾©å¸‚">å˜‰ç¾©å¸‚</option>
                            <option value="å˜‰ç¾©ç¸£">å˜‰ç¾©ç¸£</option>
                            <option value="å°å—å¸‚">å°å—å¸‚</option>
                            <option value="é«˜é›„å¸‚">é«˜é›„å¸‚</option>
                            <option value="å±æ±ç¸£">å±æ±ç¸£</option>
                            <option value="å®œè˜­ç¸£">å®œè˜­ç¸£</option>
                            <option value="èŠ±è“®ç¸£">èŠ±è“®ç¸£</option>
                            <option value="å°æ±ç¸£">å°æ±ç¸£</option>
                            <option value="æ¾æ¹–ç¸£">æ¾æ¹–ç¸£</option>
                            <option value="é‡‘é–€ç¸£">é‡‘é–€ç¸£</option>
                            <option value="é€£æ±Ÿç¸£">é€£æ±Ÿç¸£</option>
                        </select>
                        <input type="text" id="cust-addr-detail" class="form-input" placeholder="é„‰é®å¸‚å€ / è¡—é“ / é–€è™Ÿ">
                    </div>
                </div>

                <div class="form-group" style="margin-top: 15px;">
                    <label class="form-label">å‚™è¨» (æ¯ç›’ 6 å…¥ï¼Œè‹¥éœ€åˆ†è£è«‹å¡«å¯«)</label>
                    <textarea id="cust-remarks" class="form-input" rows="2" placeholder="ä¾‹å¦‚ï¼šåŸå‘³x2 å·§å…‹åŠ›x2 æŠ¹èŒ¶x2 è£ä¸€ç›’"></textarea>
                </div>

            </div>

            <div style="text-align: center; font-size: 0.75rem; color: #999; margin: 30px 0 10px 0; line-height: 1.6;">
                å•†è™Ÿ: ç”²è³€é£Ÿå“<br>
                çµ±ä¸€ç·¨è™Ÿ: 94427773<br>
                åœ°å€: å½°åŒ–å¸‚ä¸‰æ°‘è·¯ 418 å·· 23 è™Ÿ<br>
                è¨‚è³¼é›»è©±: 0972-005078<br>
                é£Ÿå“ç™»éŒ„å­—è™Ÿ: N-194427773-00000-4<br>
                å·²æŠ•ä¿ åœ‹æ³°ç”¢éšª ç”¢å“è²¬ä»»éšª<br><br>
                
                <span id="busuanzi_container_site_pv" style="display:none;">
                    ç´¯ç©ç€è¦½äººæ¬¡ï¼š<span id="busuanzi_value_site_pv"></span>
                </span>
                <br><br>

                <div style="display: flex; align-items: center; justify-content: center; gap: 8px;">
                    <a href="https://lin.ee/UHEkfgW" target="_blank" class="line-btn-style">
                        ğŸ’¬ é»æ“ŠåŠ å…¥å®˜æ–¹ LINE
                    </a>
                    <span style="font-size: 0.9rem; font-weight: bold; color: #06c755;">ID: @817ytyld</span>
                </div>
            </div>

        </div>

        <div class="bottom-bar">
            <div class="price-area">
                <div style="font-size:0.8rem; color:#666;">
                    è¨‚å–®é‡‘é¡ (å…± <span id="total-cups-badge" style="font-weight:bold; color:#333;">0</span> å€‹)
                    <span id="discount-badge" class="discount-tag">95æŠ˜</span>
                </div>
                <div class="total-price">NT$ <span id="final-total">0</span></div>
                <div class="promo-hint">
                    æ»¿ $3000 æ‰“ 95 æŠ˜ / æ»¿ $5000 æ‰“ 9 æŠ˜<br>
                    æ»¿ 6 å…¥ç›’è£
                </div>
            </div>
            <button class="checkout-btn" id="submit-btn" onclick="processCheckout()">ç¢ºèªé€å‡º</button>
        </div>
    </div>

    <div id="receipt-view">
        <img src="logo.jpg" alt="Logo" class="receipt-logo">
        <div class="receipt-icon">âœ”</div>
        <div class="receipt-title">è¨‚å–®å·²æˆç«‹</div>
        <div class="receipt-time" id="receipt-time"></div>

        <div class="receipt-card">
            <div id="receipt-items"></div>
            <div class="receipt-row bold">
                <span>ç¸½é‡‘é¡ (å«é‹)</span>
                <span style="color:#d63031" id="receipt-total"></span>
            </div>
        </div>

        <div class="receipt-card">
            <div class="receipt-row"><span>è¨‚å–®ç·¨è™Ÿ</span><span id="receipt-order-id" style="font-weight:bold; color:#00c300;"></span></div>
            <div class="receipt-row"><span>ç¸½æ•¸é‡</span><span id="receipt-cups"></span></div>
            <div class="receipt-row"><span>è¨‚è³¼äºº</span><span id="receipt-name"></span></div>
            <div class="receipt-row"><span>é›»è©±</span><span id="receipt-phone"></span></div>
            <div class="receipt-row"><span>å–è²¨æ–¹å¼</span><span id="receipt-delivery"></span></div>
            <div class="receipt-row"><span>æ—¥æœŸ</span><span id="receipt-date"></span></div>
            <div class="receipt-row" id="receipt-address-row" style="display:none;">
                <span>åœ°å€</span><span id="receipt-address"></span>
            </div>
            <div class="receipt-row" id="receipt-remarks-row" style="display:none; flex-direction:column; align-items:flex-start;">
                <span style="color:#666; font-size:0.9rem;">å‚™è¨»</span>
                <span id="receipt-remarks" style="color:#333; font-weight:bold; margin-top:3px;"></span>
            </div>
        </div>

        <div id="bank-info-area" class="receipt-bank-box" style="display:none;">
            <div class="bank-title">è«‹åŒ¯æ¬¾è‡³ä»¥ä¸‹å¸³è™Ÿï¼š</div>
            <div style="margin-bottom:5px;">ç‰å±±éŠ€è¡Œ (808)</div>
            <div class="bank-detail-row">
                <div class="bank-detail" id="bank-acc-num">0336979095995</div>
                <button class="copy-btn" onclick="copyBankAccount()">è¤‡è£½å¸³è™Ÿ</button>
            </div>
            <div style="font-size:0.9rem; color:#666; margin-top:5px;">æˆ¶åï¼šé‡‘å† åŸ</div>
        </div>

        <div class="screenshot-box">
            <div class="screenshot-icon">ğŸ“¸</div>
            <div class="screenshot-text">
                è«‹æˆªåœ–æ­¤ç•«é¢<br>
                ä¸¦å‚³é€çµ¦å®˜æ–¹å®¢æœ LINE
            </div>
        </div>

        <div style="text-align: center; margin-bottom: 20px;">
            <a href="https://lin.ee/UHEkfgW" target="_blank" class="line-btn-style" style="width: 100%; box-sizing: border-box; margin-bottom: 10px;">
                ğŸ’¬ åŠ å…¥å®˜æ–¹ LINE å‚³é€è¨‚å–®
            </a>
            <div style="font-size: 0.9rem; font-weight: bold; color: #06c755;">ID: @817ytyld</div>
        </div>

        <a id="linepay-btn" href="#" class="pay-btn" style="display:none;">å‰å¾€ LINE Pay ä»˜æ¬¾</a>
        <button onclick="window.location.reload()" class="pay-btn home-btn">è¿”å›é¦–é  / å†ä¸‹ä¸€å–®</button>
    </div>

    <script>
        // --- è¨­å®šå€ ---
        
        // â˜…â˜…â˜… è«‹å‹™å¿…ç¢ºèªé€™è£¡çš„ç¶²å€å·²å¡«å…¥æ‚¨çš„ Apps Script ç¶²å€ (å¦‚æœæ²’æœ‰è¦æµé‡çµ±è¨ˆå¯ç•™ç©º) â˜…â˜…â˜…
        const TRAFFIC_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbw9_YOUR_ID_HERE/exec"; 
        
        // Google Form å›å‚³ç¶²å€
        const GOOGLE_FORM_URL = "https://docs.google.com/forms/d/e/1FAIpQLSenpCJdVZWJ4seiaz4GimXwasppPbnX3o1pLGyrnIMWaJ_sqw/formResponse";
        
        // Google Form æ¬„ä½ ID
        const FORM_FIELDS = {
            orderContent: "entry.1214769536", 
            name:         "entry.537178649",  
            phone:        "entry.1240845794", 
            payment:      "entry.36879241",   
            delivery:     "entry.2126181854", 
            address:      "entry.1346414492", 
            date:         "entry.1111858266", 
            cups:         "entry.1482122773", 
            subtotal:     "entry.1558685102", 
            shipping:     "entry.1750953999", 
            totalPrice:   "entry.816848611",
            remarks:      "entry.370850133",  
            orderId:      "entry.846286532",
            discountAmount: "entry.1977990591" // â˜… æ–°å¢æŠ˜æ‰£é‡‘é¡æ¬„ä½
        };

        // LINE Pay é€£çµ
        const LINE_PAY_LINK = "https://qrcodepay.line.me/qr/payment/uemRyQGLoTi6F3OUSEUgEtlr9QjZ1vTlUUVy930W3RPAgapaVWJM%252BrFuHzZRvpGA";
        
        // å•†å“è³‡æ–™
        const menuData = [
            { id: 1, name: "ç¶“å…¸åŸå‘³", price: 45, image: "230242.jpg", desc: "æ¿ƒéƒå¥¶é¦™ã€ç¶¿å¯†æ»‘é †ï¼Œç†±è³£å¿…è²·çš„äººæ°£å£å‘³ã€‚" },
            { id: 2, name: "å·§å…‹åŠ›", price: 50, image: "230240_0.jpg", desc: "é¸ç”¨æ³•èŠ™å¨œå¯å¯ï¼Œå¯å¯é¦™æ¿ƒéƒï¼Œå¤§äººå°å­©éƒ½æ„›ã€‚" },
            { id: 3, name: "èŠéº»", price: 50, image: "230239_0.jpg", desc: "åš´é¸ 100% é»‘èŠéº»ç ”ç£¨ï¼ŒèŠéº»é¦™æ°£æ¿ƒåšï¼Œå£æ„Ÿå¾®é¡†ç²’ã€‚" },
            { id: 4, name: "æŠ¹èŒ¶", price: 50, image: "230234_0.jpg", desc: "æŠ¹èŒ¶é¦™æ°£é†‡åšï¼Œå¾®è‹¦ç”œå¹³è¡¡ï¼Œç¶¿å¯†ä¸è†©ã€‚" },
            { id: 5, name: "å’–å•¡", price: 50, image: "230236_0.jpg", desc: "é˜¿æ‹‰æ¯”å¡å’–å•¡è±†ï¼Œå¸¶æŸ‘æ©˜æœé¦™ï¼Œå’–å•¡èˆ‡å¥¶é¦™å®Œç¾èåˆã€‚" },
            { id: 6, name: "æ³°å¼å¥¶èŒ¶", price: 50, image: "230235_0.jpg", desc: "æ‰‹æ¨™æ³°å¼ç´…èŒ¶å…ˆç‚’å‡ºèŒ¶é¦™ï¼Œæ³°å¥¶é¦™æ°£æ¿ƒéƒï¼Œç”œè€Œä¸è†©ã€‚" },
            { id: 7, name: "ä¼¯çˆµç´…èŒ¶", price: 50, image: "230241_0.jpg", desc: "å¤§äººç³»å£å‘³ï¼Œä½›æ‰‹æŸ‘æ¸…é¦™ï¼ŒèŒ¶é¦™èˆ‡å¥¶é¦™åœ“æ½¤èåˆã€‚" },
            { id: 8, name: "èŠ‹é¦™ç´«è–¯", price: 50, image: "230237_0.jpg", desc: "ç´°ç«ç†¬ç…®ï¼Œå£æ„Ÿç´°ç¶¿ï¼Œæ·¡æ·¡èŠ‹é¦™èˆ‡è‡ªç„¶ç´«è–¯è‰²ã€‚" },
            { id: 9, name: "å¾®é†ºè˜­å§†", price: 50, image: "230233_0.jpg", desc: "æˆå¹´äººçš„å¾®é†ºå¿«æ¨‚ï¼Œæ·¡æ·¡é…’é¦™ï¼Œå¥¶é¦™ä¸­å¸¶é†‰äººé¤˜éŸ»ã€‚" },
            { id: 10, name: "åè–°èŒ‰ç¶  (é™å®šå£å‘³)", price: 50, image: "230243.jpg", desc: "èŒ‰è‰èŠ±é¦™èˆ‡ç¶ èŒ¶æŸ”å’Œäº¤ç¹”ï¼Œæ·¡é›…èŒ¶éŸ»ï¼Œæ­é…æ»‘é †å¥¶é…ªã€‚" }
        ];

        // å„ªæƒ åˆ¸è¨­å®š
        const COUPONS = {
            "VIP95": { type: "rate", value: 0.95, name: "å¥½é…ªå‹95æŠ˜" },
            "LINE50": { type: "minus", value: 50, name: "å¥½å‹ç¾æŠ˜50" }
        };

        let cart = []; 
        let appliedCoupon = null; // ç´€éŒ„ç›®å‰ä½¿ç”¨çš„å„ªæƒ åˆ¸

        const menuContainer = document.getElementById('menu-list');
        const cartContainer = document.getElementById('cart-list');
        const totalEl = document.getElementById('final-total');
        const discountBadge = document.getElementById('discount-badge');
        const loadingOverlay = document.getElementById('loading-overlay');

        function init() {
            // æµé‡çµ±è¨ˆ
            logVisit();

            menuContainer.innerHTML = '';
            menuData.forEach(item => {
                const div = document.createElement('div');
                div.className = 'menu-item';
                div.innerHTML = `
                    <img src="${item.image}" alt="${item.name}" class="menu-img">
                    <div class="menu-name">${item.name}</div>
                    <div class="menu-desc">${item.desc}</div>
                    <div class="menu-price">$${item.price}</div>
                    <button class="add-btn" onclick="addToCart(${item.id})">åŠ å…¥</button>
                `;
                menuContainer.appendChild(div);
            });
            updateDateSettings('pickup');
            renderCart();
        }

        // æµé‡çµ±è¨ˆå‡½æ•¸
        function logVisit() {
            if(!TRAFFIC_SCRIPT_URL || TRAFFIC_SCRIPT_URL.includes("YOUR_ID_HERE")) return;

            fetch(TRAFFIC_SCRIPT_URL, {
                method: "POST",
                mode: "no-cors", 
                body: JSON.stringify({ action: "view" }) 
            }).catch(err => console.log("Tracking log error (safe to ignore)"));
        }

        function updateDateSettings(mode) {
            const selectEl = document.getElementById('pickup-slot-select');
            const deliveryText = document.getElementById('delivery-date-text');
            const hint = document.getElementById('date-hint');
            const addressRow = document.getElementById('address-row');
            const pickupInfoBox = document.getElementById('pickup-info-box');
            const deliveryInfoBox = document.getElementById('delivery-info-box');
            
            const now = new Date();
            const currentHour = now.getHours();

            if (mode === 'delivery') {
                selectEl.style.display = 'none';
                deliveryText.style.display = 'block';
                hint.innerText = "æé†’ï¼šå®…é…é»˜èªä¸æŒ‡å®šæ—¥æœŸå‡ºè²¨ï¼Œè‹¥éœ€æŒ‡å®šæ—¥æœŸè«‹å…ˆèˆ‡åº—å®¶è©¢å•ã€‚";
                addressRow.style.display = 'block';
                pickupInfoBox.style.display = 'none'; 
                deliveryInfoBox.style.display = 'block'; 
            } else {
                selectEl.style.display = 'block';
                deliveryText.style.display = 'none';
                addressRow.style.display = 'none';
                pickupInfoBox.style.display = 'block'; 
                deliveryInfoBox.style.display = 'none';

                let daysToAdd = (currentHour < 12) ? 2 : 3; 
                hint.innerText = (currentHour < 12) 
                    ? "æé†’ï¼šä¸­åˆ 12:00 å‰ä¸‹å–®ï¼Œæœ€å¿«å¯é¸å¾Œå¤©è‡ªå–æ™‚æ®µ" 
                    : "æé†’ï¼šå·²éä¸­åˆ 12:00ï¼Œéœ€é ç•™å‚™æ–™ï¼Œæœ€å¿«å¤§å¾Œå¤©è‡ªå–æ™‚æ®µ";

                generatePickupOptions(daysToAdd);
            }
        }

        function generatePickupOptions(startDays) {
            const select = document.getElementById('pickup-slot-select');
            select.innerHTML = '<option value="" disabled selected>è«‹é¸æ“‡è‡ªå–æ™‚æ®µ...</option>';
            
            const now = new Date();
            let startDate = new Date(now);
            startDate.setDate(startDate.getDate() + startDays);
            
            for(let i=0; i<30; i++) {
                let current = new Date(startDate);
                current.setDate(startDate.getDate() + i);
                
                let day = current.getDay(); 
                let month = current.getMonth() + 1;
                let date = current.getDate();
                let dayStr = ['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'][day];
                let dateStr = `${month}/${date} (é€±${dayStr})`;
                let fullDateStr = `${current.getFullYear()}/${String(month).padStart(2,'0')}/${String(date).padStart(2,'0')} (${dayStr})`;

                if (day >= 2 && day <= 5) {
                    let opt1 = document.createElement('option');
                    opt1.value = `${fullDateStr} 12:00~13:00`;
                    opt1.innerText = `${dateStr} 12:00~13:00`;
                    select.appendChild(opt1);

                    let opt2 = document.createElement('option');
                    opt2.value = `${fullDateStr} 17:00~18:00`;
                    opt2.innerText = `${dateStr} 17:00~18:00`;
                    select.appendChild(opt2);
                }
                else if (day === 6) {
                    let opt3 = document.createElement('option');
                    opt3.value = `${fullDateStr} 10:00~12:00`;
                    opt3.innerText = `${dateStr} 10:00~12:00`;
                    select.appendChild(opt3);
                }
            }
        }

        function copyBankAccount() {
            const accNum = document.getElementById('bank-acc-num').innerText;
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(accNum).then(() => {
                    alert("å¸³è™Ÿå·²è¤‡è£½ï¼");
                }).catch(err => {
                    alert("è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½");
                });
            } else {
                const textArea = document.createElement("textarea");
                textArea.value = accNum;
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    alert("å¸³è™Ÿå·²è¤‡è£½ï¼");
                } catch (err) {
                    alert("è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½");
                }
                document.body.removeChild(textArea);
            }
        }

        function addToCart(id) {
            const existingItem = cart.find(item => item.id === id);
            if (existingItem) existingItem.quantity++;
            else cart.push({ ...menuData.find(p => p.id === id), quantity: 1 });
            
            // Google Ads Conversion
            gtag('event', 'conversion', {'send_to': 'AW-17855729381/CJdUcKeW794bEOwDo8JC'});

            renderCart();
        }

        // æ‡‰ç”¨å„ªæƒ åˆ¸åŠŸèƒ½
        function applyCoupon() {
            const input = document.getElementById('coupon-code');
            const msg = document.getElementById('coupon-msg');
            const code = input.value.trim().toUpperCase();

            if (!code) {
                msg.innerText = "è«‹è¼¸å…¥å„ªæƒ ç¢¼";
                msg.style.color = "red";
                return;
            }

            if (COUPONS[code]) {
                appliedCoupon = { code: code, ...COUPONS[code] };
                msg.innerText = "âœ… å„ªæƒ ç¢¼å·²å¥—ç”¨ï¼";
                msg.style.color = "green";
                renderCart(); // é‡æ–°è¨ˆç®—åƒ¹æ ¼
            } else {
                appliedCoupon = null;
                msg.innerText = "âŒ ç„¡æ•ˆçš„å„ªæƒ ç¢¼";
                msg.style.color = "red";
                renderCart();
            }
        }

        function renderCart() {
            cartContainer.innerHTML = '';
            let rawTotal = 0; 
            let totalCups = 0; 

            if (cart.length === 0) {
                cartContainer.innerHTML = '<div class="empty-cart-msg">è³¼ç‰©è»Šç›®å‰æ˜¯ç©ºçš„</div>';
                totalEl.innerText = '0';
                discountBadge.style.display = 'none'; 
                document.getElementById('total-cups-badge').innerText = '0'; 
                return;
            }
            cart.forEach((item, index) => {
                rawTotal += item.price * item.quantity;
                totalCups += item.quantity; 
                
                let warningHtml = '';
                if (item.id === 9) {
                    warningHtml = '<div class="adult-warn">(æœªæ»¿18æ­²è«‹å‹¿è³¼è²·)</div>';
                }

                const div = document.createElement('div');
                div.className = 'cart-item';
                div.style.borderLeftColor = '#ddd'; 
                div.innerHTML = `
                    <div class="cart-info">
                        <div class="cart-title">${item.name}</div>
                        <div class="cart-subtotal">$${item.price} x ${item.quantity} = $${item.price * item.quantity}</div>
                    </div>
                    <div class="cart-right-col">
                        <div class="qty-control">
                            <button class="qty-btn" onclick="changeQty(${index}, -1)">-</button>
                            <span>${item.quantity}</span>
                            <button class="qty-btn" onclick="changeQty(${index}, 1)">+</button>
                        </div>
                        ${warningHtml}
                    </div>
                `;
                cartContainer.appendChild(div);
            });
            
            document.getElementById('total-cups-badge').innerText = totalCups;

            // è¨ˆç®—æœ€çµ‚åƒ¹æ ¼é‚è¼¯
            let finalPrice = rawTotal;
            let discountText = "";

            if (appliedCoupon) {
                // æœ‰å„ªæƒ åˆ¸ï¼Œå¼·åˆ¶å¥—ç”¨ï¼Œä¸é¡¯ç¤ºæ»¿é¡æ¨™ç±¤ä»¥å…æ··æ·†
                discountBadge.style.display = 'inline-block';
                discountBadge.innerText = 'åˆ¸';
                
                if (appliedCoupon.type === 'rate') {
                    finalPrice = Math.floor(rawTotal * appliedCoupon.value);
                } else if (appliedCoupon.type === 'minus') {
                    finalPrice = rawTotal - appliedCoupon.value;
                }
            } else {
                // æ²’æœ‰å„ªæƒ åˆ¸ï¼Œæª¢æŸ¥æ»¿é¡
                if (rawTotal >= 5000) {
                    finalPrice = Math.floor(rawTotal * 0.9);
                    discountBadge.style.display = 'inline-block'; 
                    discountBadge.innerText = '9æŠ˜';
                } else if (rawTotal >= 3000) {
                    finalPrice = Math.floor(rawTotal * 0.95);
                    discountBadge.style.display = 'inline-block'; 
                    discountBadge.innerText = '95æŠ˜';
                } else {
                    discountBadge.style.display = 'none';
                }
            }

            // é˜²æ­¢è² æ•¸
            if (finalPrice < 0) finalPrice = 0;

            totalEl.innerText = finalPrice.toLocaleString();
        }

        function changeQty(index, delta) {
            cart[index].quantity += delta;
            if (cart[index].quantity <= 0) cart.splice(index, 1);
            renderCart();
        }

        function processCheckout() {
            if (cart.length === 0) { alert("è«‹å…ˆåŠ å…¥å•†å“"); return; }

            const name = document.getElementById('cust-name').value.trim();
            const phone = document.getElementById('cust-phone').value.trim();
            const delivery = document.querySelector('input[name="deliveryMethod"]:checked').value;
            const payment = document.querySelector('input[name="paymentMethod"]:checked').value;
            const remarks = document.getElementById('cust-remarks').value.trim(); 
            
            let fullAddress = "";
            const city = document.getElementById('cust-city').value;
            const detailAddr = document.getElementById('cust-addr-detail').value.trim();

            if(!name || !phone) { alert("è«‹å¡«å¯«å§“åèˆ‡é›»è©±"); return; }
            
            let finalDateStr = "";
            if(delivery === 'è‡ªå–') {
                const slot = document.getElementById('pickup-slot-select').value;
                if(!slot) { alert("è«‹é¸æ“‡è‡ªå–æ™‚æ®µ"); return; }
                finalDateStr = slot;
            } else {
                if(!city || !detailAddr) {
                    alert("å®…é…è«‹å‹™å¿…é¸æ“‡ç¸£å¸‚ä¸¦å¡«å¯«è©³ç´°åœ°å€");
                    return;
                }
                fullAddress = city + detailAddr;
                finalDateStr = "å®…é…ä¸æŒ‡å®šæ—¥æœŸ (éœ€æŒ‡å®šè«‹æ´½å®¢æœ)";
            }

            let rawTotal = 0;
            let totalCups = 0;
            let orderDetails = ""; 
            let msgDetails = ""; 
            cart.forEach(p => {
                rawTotal += p.price * p.quantity;
                totalCups += p.quantity;
                
                // â˜… ç´”æ·¨ç‰ˆè¨‚å–®æ˜ç´°ï¼šåªä¿ç•™ã€Œå“é …æ•¸é‡ã€èˆ‡ã€Œé€—è™Ÿã€
                orderDetails += `${p.name}x${p.quantity}, `; 
                
                msgDetails += `- ${p.name} x ${p.quantity} = $${p.price*p.quantity}\n`;
            });
            
            if (delivery === 'å®…é…' && totalCups % 6 !== 0) {
                alert(`å®…é…è¨‚å–®ç‚ºäº†é˜²æ­¢é‹é€ç¢°æ’ï¼Œæ•¸é‡å¿…é ˆæ˜¯ 6 çš„å€æ•¸ã€‚\nç›®å‰æ•¸é‡ï¼š${totalCups} å€‹\nå»ºè­°èª¿æ•´ç‚º ${Math.ceil(totalCups/6)*6} æˆ– ${Math.floor(totalCups/6)*6} å€‹`);
                return; 
            }

            // è¨ˆç®—æœ€çµ‚é‡‘é¡ (å‚³é€çµ¦å¾Œç«¯çš„è³‡æ–™ + é¡¯ç¤ºçµ¦å®¢äººçœ‹)
            let productFinalPrice = rawTotal;
            let discountName = "";
            let discountAmount = 0;

            if (appliedCoupon) {
                let original = rawTotal;
                if (appliedCoupon.type === 'rate') {
                    productFinalPrice = Math.floor(rawTotal * appliedCoupon.value);
                    discountName = appliedCoupon.name; 
                } else if (appliedCoupon.type === 'minus') {
                    productFinalPrice = rawTotal - appliedCoupon.value;
                    discountName = appliedCoupon.name;
                }
                discountAmount = original - productFinalPrice;
            } else {
                if (rawTotal >= 5000) {
                    productFinalPrice = Math.floor(rawTotal * 0.9);
                    discountName = "æ»¿é¡9æŠ˜";
                    discountAmount = rawTotal - productFinalPrice;
                } else if (rawTotal >= 3000) {
                    productFinalPrice = Math.floor(rawTotal * 0.95);
                    discountName = "æ»¿é¡95æŠ˜";
                    discountAmount = rawTotal - productFinalPrice;
                }
            }

            // å®…é…é‹è²»
            let shippingFee = 0;
            if (delivery === 'å®…é…') {
                const boxes = totalCups / 6; 
                if(boxes <= 2) {
                    shippingFee = 130; 
                } else if (boxes <= 8) {
                    shippingFee = 170; 
                } else {
                    shippingFee = 210; 
                }
            }

            let finalAllPrice = productFinalPrice + shippingFee;

            // â˜… ç”Ÿæˆç´”æ•¸å­—è¨‚å–®ç·¨è™Ÿ
            const now = new Date();
            const yyyy = now.getFullYear();
            const mm = String(now.getMonth() + 1).padStart(2, '0');
            const dd = String(now.getDate()).padStart(2, '0');
            const hh = String(now.getHours()).padStart(2, '0');
            const min = String(now.getMinutes()).padStart(2, '0');
            const sec = String(now.getSeconds()).padStart(2, '0');
            const orderId = `${yyyy}${mm}${dd}${hh}${min}${sec}`;

            // â˜…â˜…â˜… è©³ç´°çµå¸³å°è·³çª— (Popup) â˜…â˜…â˜…
            let confirmMsg = `ã€è¨‚å–®ç¢ºèªã€‘\n`;
            confirmMsg += `---------------------\n`;
            confirmMsg += `å•†å“åŸåƒ¹ï¼š$${rawTotal}\n`;
            
            if (discountAmount > 0) {
                confirmMsg += `æŠ˜æ‰£å„ªæƒ ï¼š-$${discountAmount} (${discountName})\n`;
            }
            
            if (shippingFee > 0) {
                confirmMsg += `é‹è²»å°è¨ˆï¼š$${shippingFee} (ä½æº«å®…é…)\n`;
            } else {
                confirmMsg += `é‹è²»å°è¨ˆï¼š$0 (${delivery})\n`;
            }

            confirmMsg += `---------------------\n`;
            confirmMsg += `æ‡‰ä»˜ç¸½é¡ï¼š$${finalAllPrice}\n`;
            confirmMsg += `---------------------\n`;
            
            confirmMsg += `å–è²¨æ–¹å¼ï¼š${delivery}\n`;
            confirmMsg += `æ—¥æœŸï¼š${finalDateStr}\n`; 
            confirmMsg += `å§“åï¼š${name}\n`;
            confirmMsg += `é›»è©±ï¼š${phone}\n`;
            if(delivery === 'å®…é…') confirmMsg += `åœ°å€ï¼š${fullAddress}\n`;
            if(remarks) confirmMsg += `å‚™è¨»ï¼š${remarks}\n`;
            confirmMsg += `ä»˜æ¬¾æ–¹å¼ï¼š${payment === 'linepay' ? 'LINE Pay' : 'éŠ€è¡ŒåŒ¯æ¬¾'}\n`;
            
            confirmMsg += `\nè«‹ç¢ºèªä»¥ä¸Šè³‡è¨Šç„¡èª¤ï¼Œé»æ“Šã€Œç¢ºå®šã€é€å‡ºè¨‚å–®ã€‚`;

            if (!confirm(confirmMsg)) {
                return; 
            }

            loadingOverlay.style.display = 'flex';
            document.getElementById('submit-btn').disabled = true;

            // â˜… ä¿®æ­£ï¼šè¨‚å–®æ˜ç´°å­—ä¸² (ç´”æ·¨ç‰ˆï¼Œåªå«å“é …æ•¸é‡) + æ¯æ•¸
            let fullOrderInfo = orderDetails + ` [å…±${totalCups}å€‹]`;
            if(shippingFee > 0) fullOrderInfo += ` [é‹è²»$${shippingFee}]`;

            let formData = new FormData();
            formData.append(FORM_FIELDS.orderContent, fullOrderInfo); 
            formData.append(FORM_FIELDS.name, name);                  
            formData.append(FORM_FIELDS.phone, phone);                
            formData.append(FORM_FIELDS.payment, payment);            
            formData.append(FORM_FIELDS.delivery, delivery);          
            formData.append(FORM_FIELDS.address, fullAddress);        
            formData.append(FORM_FIELDS.date, finalDateStr);          
            formData.append(FORM_FIELDS.cups, totalCups);             
            formData.append(FORM_FIELDS.subtotal, productFinalPrice); 
            formData.append(FORM_FIELDS.shipping, shippingFee);        
            formData.append(FORM_FIELDS.totalPrice, finalAllPrice);
            formData.append(FORM_FIELDS.remarks, remarks);
            formData.append(FORM_FIELDS.orderId, orderId); 
            formData.append(FORM_FIELDS.discountAmount, discountAmount); 

            fetch(GOOGLE_FORM_URL, {
                method: "POST",
                body: formData,
                mode: "no-cors"
            }).then(() => {
                showReceipt(name, phone, finalDateStr, delivery, payment, fullAddress, finalAllPrice, totalCups, shippingFee, remarks, orderId, rawTotal, discountAmount, discountName);
                loadingOverlay.style.display = 'none';
            }).catch(err => {
                alert("è¨‚å–®å‚³é€å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯æˆ–ç¨å¾Œå†è©¦ã€‚\n" + err);
                loadingOverlay.style.display = 'none';
                document.getElementById('submit-btn').disabled = false;
            });
        }

        // ä¿®æ”¹ showReceipt æ¥æ”¶æ›´å¤šåƒæ•¸ï¼Œä»¥é¡¯ç¤ºè©³ç´°æ˜ç´°
        function showReceipt(name, phone, dateStr, delivery, payment, fullAddress, finalAllPrice, totalCups, shippingFee, remarks, orderId, rawTotal, discountAmount, discountName) {
            const now = new Date();
            document.getElementById('receipt-time').innerText = "è¨‚å–®æ™‚é–“ï¼š" + now.toLocaleString('zh-TW', {hour12: false});
            document.getElementById('receipt-order-id').innerText = orderId;

            let itemsHtml = '';
            cart.forEach(p => {
                itemsHtml += `<div class="receipt-row"><span>${p.name} x ${p.quantity}</span><span>$${p.price * p.quantity}</span></div>`;
            });
            
            // --- æ–°å¢ï¼šçµå¸³æ˜ç´°å€å¡Š ---
            itemsHtml += `<hr style="border:0; border-top:1px dashed #ddd; margin:15px 0;">`;
            itemsHtml += `<div class="receipt-row"><span>å•†å“å°è¨ˆ</span><span>$${rawTotal}</span></div>`;
            
            if (discountAmount > 0) {
                itemsHtml += `<div class="receipt-row discount-row"><span>${discountName}</span><span>-$${discountAmount}</span></div>`;
            }
            
            if (shippingFee > 0) {
                itemsHtml += `<div class="receipt-row"><span>é‹è²» (æ–°ç«¹ç‰©æµ)</span><span>$${shippingFee}</span></div>`;
            } else {
                itemsHtml += `<div class="receipt-row"><span>é‹è²» (${delivery})</span><span>$0</span></div>`;
            }
            // -------------------------

            document.getElementById('receipt-items').innerHTML = itemsHtml;
            document.getElementById('receipt-total').innerText = "NT$ " + finalAllPrice;

            document.getElementById('receipt-cups').innerText = totalCups + " å€‹";
            document.getElementById('receipt-name').innerText = name;
            document.getElementById('receipt-phone').innerText = phone;
            document.getElementById('receipt-delivery').innerText = delivery;
            document.getElementById('receipt-date').innerText = dateStr;
            
            if(delivery === 'å®…é…') {
                document.getElementById('receipt-address-row').style.display = 'flex';
                document.getElementById('receipt-address').innerText = fullAddress;
            } else {
                document.getElementById('receipt-address-row').style.display = 'none';
            }

            if(remarks) {
                document.getElementById('receipt-remarks-row').style.display = 'flex';
                document.getElementById('receipt-remarks').innerText = remarks;
            } else {
                document.getElementById('receipt-remarks-row').style.display = 'none';
            }

            const bankArea = document.getElementById('bank-info-area');
            const lineBtn = document.getElementById('linepay-btn');

            if(payment === 'linepay') {
                bankArea.style.display = 'none';
                lineBtn.style.display = 'block';
                lineBtn.href = LINE_PAY_LINK;
                lineBtn.innerText = "å‰å¾€ LINE Pay ä»˜æ¬¾ ($" + finalAllPrice + ")";
            } else {
                bankArea.style.display = 'block';
                lineBtn.style.display = 'none';
            }

            document.getElementById('shop-view').style.display = 'none';
            document.getElementById('receipt-view').style.display = 'block';
            window.scrollTo(0, 0);
        }

        init();
    </script>
</body>
</html>
